From 148c540e6d70c3c6a089b31610f8d29cd606c8bb Mon Sep 17 00:00:00 2001
From: huzhen <george.hu@spacemit.com>
Date: Fri, 21 Jun 2024 17:42:29 +0800
Subject: [PATCH 0793/1448] wireless: support pcie wifi rtl8852be

Change-Id: Ifcd5521808b740547ba0e6113de56aff31978f79
---
 arch/riscv/configs/k1_defconfig                                 | 1 +
 drivers/net/wireless/realtek/rtl8852be/os_dep/linux/wifi_regd.c | 2 ++
 2 files changed, 3 insertions(+)

diff --git a/arch/riscv/configs/k1_defconfig b/arch/riscv/configs/k1_defconfig
index 333330fa8727..cbba41739d10 100644
--- a/arch/riscv/configs/k1_defconfig
+++ b/arch/riscv/configs/k1_defconfig
@@ -342,6 +342,7 @@ CONFIG_USB_NET_ASIX=m
 # CONFIG_WLAN_VENDOR_PURELIFI is not set
 # CONFIG_WLAN_VENDOR_RALINK is not set
 CONFIG_RTL8852BS=m
+CONFIG_RTL8852BE=m
 # CONFIG_WLAN_VENDOR_RSI is not set
 # CONFIG_WLAN_VENDOR_SILABS is not set
 # CONFIG_WLAN_VENDOR_ST is not set
diff --git a/drivers/net/wireless/realtek/rtl8852be/os_dep/linux/wifi_regd.c b/drivers/net/wireless/realtek/rtl8852be/os_dep/linux/wifi_regd.c
index 1f5a242f2ec8..6a229655c5b2 100644
--- a/drivers/net/wireless/realtek/rtl8852be/os_dep/linux/wifi_regd.c
+++ b/drivers/net/wireless/realtek/rtl8852be/os_dep/linux/wifi_regd.c
@@ -1268,8 +1268,10 @@ int rtw_regd_init(struct wiphy *wiphy)
 #endif
 
 #if (LINUX_VERSION_CODE >= KERNEL_VERSION(3, 19, 0))
+#if (LINUX_VERSION_CODE <= KERNEL_VERSION(6, 4, 3))
 	wiphy->regulatory_flags |= REGULATORY_IGNORE_STALE_KICKOFF;
 #endif
+#endif
 
 #if (LINUX_VERSION_CODE >= KERNEL_VERSION(4, 0, 0))
 	if (rtw_regd_is_wiphy_self_managed(wiphy))
-- 
2.47.0

