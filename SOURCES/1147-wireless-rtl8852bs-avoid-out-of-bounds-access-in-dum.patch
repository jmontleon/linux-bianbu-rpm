From 9bc10f48d9551791fcb46f4dbbec66a793fdad28 Mon Sep 17 00:00:00 2001
From: wanlong <long.wan@spacemit.com>
Date: Tue, 10 Sep 2024 20:23:16 +0800
Subject: [PATCH 1147/1448] wireless: rtl8852bs: avoid out of bounds access in
 dump_valid_key()

Change-Id: Iee04935cb5f743457566b9467a8abc575471b193
---
 .../net/wireless/realtek/rtl8852bs/core/rtw_sec_cam.c    | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/drivers/net/wireless/realtek/rtl8852bs/core/rtw_sec_cam.c b/drivers/net/wireless/realtek/rtl8852bs/core/rtw_sec_cam.c
index aac77a4b2f3e..9f9d1162cf83 100644
--- a/drivers/net/wireless/realtek/rtl8852bs/core/rtw_sec_cam.c
+++ b/drivers/net/wireless/realtek/rtl8852bs/core/rtw_sec_cam.c
@@ -991,6 +991,15 @@ static void dump_valid_key(void* sel, u8* addr_map, u8* sec_map, u8* bssid_map\
 
 	_rtw_memcpy(SMA, &addr_map[8], ETH_ALEN);
 	_rtw_memcpy(TMA,&addr_map[14], ETH_ALEN);
+
+	if (nettype >= ARRAY_SIZE(nettype_to_string) ||
+		GET_AX_SEC_CAM_TYPE(sec_map) >= ARRAY_SIZE(enc_algo_to_string) ||
+		key_type >= ARRAY_SIZE(type_to_string)) {
+		RTW_WARN("out of range, nettype: %d enc_algor: %d key_type: %d\n",
+			nettype, GET_AX_SEC_CAM_TYPE(sec_map), key_type);
+		return;
+	}
+
 	RTW_PRINT_SEL(sel, "%-5u %s "MAC_FMT"  " MAC_FMT" " MAC_FMT\
 		" %-5u %-5u %s %-7u %-3u %s "KEY_FMT"\n", macid\
 		, nettype_to_string[nettype], MAC_ARG(SMA), MAC_ARG(TMA)\
-- 
2.47.0

