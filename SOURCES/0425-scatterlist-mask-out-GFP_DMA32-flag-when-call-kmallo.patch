From c8cb47f66d25c7205cb7904b280ee6d163a48677 Mon Sep 17 00:00:00 2001
From: Pan Junzhong <junzhong.pan@spacemit.com>
Date: Thu, 22 Feb 2024 11:53:23 +0800
Subject: [PATCH 0425/1448] scatterlist: mask out GFP_DMA32 flag when call
 kmalloc on spacemit k1x platform

Change-Id: I33222f2906558d36593d26f22c488ac42d34ec56
---
 lib/scatterlist.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/lib/scatterlist.c b/lib/scatterlist.c
index 7bc2220fea80..31d25e93730b 100644
--- a/lib/scatterlist.c
+++ b/lib/scatterlist.c
@@ -629,7 +629,11 @@ struct scatterlist *sgl_alloc_order(unsigned long long length,
 		nalloc++;
 	}
 	sgl = kmalloc_array(nalloc, sizeof(struct scatterlist),
+#if defined(CONFIG_SOC_SPACEMIT_K1X)
+			    gfp & ~(GFP_DMA | GFP_DMA32));
+#else
 			    gfp & ~GFP_DMA);
+#endif
 	if (!sgl)
 		return NULL;
 
-- 
2.47.0

