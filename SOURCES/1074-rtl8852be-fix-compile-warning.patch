From 587333509326aebe7d5d8a12d0e5a80445939ef2 Mon Sep 17 00:00:00 2001
From: Mark Zhuang <mark.zhuang@spacemit.com>
Date: Mon, 12 Aug 2024 09:41:19 +0800
Subject: [PATCH 1074/1451] rtl8852be: fix compile warning

Change-Id: Iad06dfd0cb6842650c91b8ca945b2f53f128d63d
---
 .../wireless/realtek/rtl8852be/core/rtw_wlan_util.c  |  2 ++
 .../wireless/realtek/rtl8852be/include/ieee80211.h   | 12 ++++++------
 .../wireless/realtek/rtl8852be/include/wlan_bssdef.h |  4 ++--
 .../realtek/rtl8852be/phl/hal_g6/hal_sound.c         |  1 +
 .../rtl8852be/phl/hal_g6/mac/mac_ax/security_cam.c   |  4 +++-
 .../realtek/rtl8852be/phl/hal_g6/phy/bb/halbb_api.c  |  1 +
 .../rtl8852be/phl/hal_g6/phy/bb/halbb_interface.c    |  1 +
 .../hal_g6/phy/rf/halrf_8852b/halrf_ops_rtl8852b.h   |  2 +-
 .../realtek/rtl8852be/phl/hal_g6/phy/rf/halrf_api.c  |  2 +-
 .../wireless/realtek/rtl8852be/phl/pltfm_ops_linux.h |  2 +-
 .../rtl8852be/phl/test/verify/phl_test_verify.c      |  1 +
 11 files changed, 20 insertions(+), 12 deletions(-)

diff --git a/drivers/net/wireless/realtek/rtl8852be/core/rtw_wlan_util.c b/drivers/net/wireless/realtek/rtl8852be/core/rtw_wlan_util.c
index aff2685ef70b..a270d8154020 100644
--- a/drivers/net/wireless/realtek/rtl8852be/core/rtw_wlan_util.c
+++ b/drivers/net/wireless/realtek/rtl8852be/core/rtw_wlan_util.c
@@ -2328,6 +2328,7 @@ unsigned int is_ap_in_tkip(struct _ADAPTER_LINK *padapter_link)
 			case _RSN_IE_2_:
 				if (_rtw_memcmp((pIE->data + 8), RSN_TKIP_CIPHER, 4))
 					return _TRUE;
+				break;
 
 			default:
 				break;
@@ -2365,6 +2366,7 @@ unsigned int should_forbid_n_rate(_adapter *padapter)
 				if ((_rtw_memcmp((pIE->data + 8), RSN_CIPHER_SUITE_CCMP, 4))  ||
 				    (_rtw_memcmp((pIE->data + 12), RSN_CIPHER_SUITE_CCMP, 4)))
 					return _FALSE;
+				break;
 
 			default:
 				break;
diff --git a/drivers/net/wireless/realtek/rtl8852be/include/ieee80211.h b/drivers/net/wireless/realtek/rtl8852be/include/ieee80211.h
index 1dd740c80934..4a3a4c310bb4 100644
--- a/drivers/net/wireless/realtek/rtl8852be/include/ieee80211.h
+++ b/drivers/net/wireless/realtek/rtl8852be/include/ieee80211.h
@@ -265,7 +265,7 @@ typedef struct ieee_param {
 		struct {
 			u32 len;
 			u8 reserved[32];
-			u8 data[0];
+			DECLARE_FLEX_ARRAY(u8, data);
 		} wpa_ie;
 		struct {
 			int command;
@@ -278,7 +278,7 @@ typedef struct ieee_param {
 			u8 idx;
 			u8 seq[8]; /* sequence counter (set: RX, get: TX) */
 			u16 key_len;
-			u8 key[0];
+			DECLARE_FLEX_ARRAY(u8, key);
 		} crypt;
 #ifdef CONFIG_AP_MODE
 		struct {
@@ -290,7 +290,7 @@ typedef struct ieee_param {
 		} add_sta;
 		struct {
 			u8	reserved[2];/* for set max_num_sta */
-			u8	buf[0];
+			DECLARE_FLEX_ARRAY(u8, buf);
 		} bcn_ie;
 #endif
 
@@ -301,7 +301,7 @@ typedef struct ieee_param {
 typedef struct ieee_param_ex {
 	u32 cmd;
 	u8 sta_addr[ETH_ALEN];
-	u8 data[0];
+	DECLARE_FLEX_ARRAY(u8, data);
 } ieee_param_ex;
 
 struct sta_data {
@@ -1254,7 +1254,7 @@ struct ieee80211_info_element_hdr {
 struct ieee80211_info_element {
 	u8 id;
 	u8 len;
-	u8 data[0];
+	DECLARE_FLEX_ARRAY(u8, data);
 } __attribute__((packed));
 #endif
 
@@ -1326,7 +1326,7 @@ struct ieee80211_txb {
 	u16 reserved;
 	u16 frag_size;
 	u16 payload_size;
-	struct sk_buff *fragments[0];
+	DECLARE_FLEX_ARRAY(struct sk_buff *, fragments);
 };
 
 
diff --git a/drivers/net/wireless/realtek/rtl8852be/include/wlan_bssdef.h b/drivers/net/wireless/realtek/rtl8852be/include/wlan_bssdef.h
index ef679b0d10d3..d1d6005a313e 100644
--- a/drivers/net/wireless/realtek/rtl8852be/include/wlan_bssdef.h
+++ b/drivers/net/wireless/realtek/rtl8852be/include/wlan_bssdef.h
@@ -66,7 +66,7 @@ typedef struct _NDIS_802_11_FIXED_IEs {
 typedef struct _NDIS_802_11_VARIABLE_IEs {
 	u8  ElementID;
 	u8  Length;
-	u8  data[1];
+	DECLARE_FLEX_ARRAY(u8, data);
 } NDIS_802_11_VARIABLE_IEs, *PNDIS_802_11_VARIABLE_IEs;
 
 typedef enum _NDIS_802_11_AUTHENTICATION_MODE {
@@ -151,7 +151,7 @@ typedef struct _NDIS_802_11_FIXED_IEs {
 typedef struct _NDIS_802_11_VARIABLE_IEs {
 	u8  ElementID;
 	u8  Length;
-	u8  data[1];
+	DECLARE_FLEX_ARRAY(u8, data);
 } NDIS_802_11_VARIABLE_IEs, *PNDIS_802_11_VARIABLE_IEs;
 
 typedef enum _NDIS_802_11_AUTHENTICATION_MODE {
diff --git a/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/hal_sound.c b/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/hal_sound.c
index 1d9aef7389fa..c19e15d480e1 100644
--- a/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/hal_sound.c
+++ b/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/hal_sound.c
@@ -127,6 +127,7 @@ u8 _get_bw_ru_end_idx(enum channel_width bw) {
 	case CHANNEL_WIDTH_160:
 	case CHANNEL_WIDTH_80_80:
 		ru_end_idx = HAL_NPDA_RU_IDX_END_160MHZ;
+	break;
 	default:
 	break;
 	}
diff --git a/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/mac/mac_ax/security_cam.c b/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/mac/mac_ax/security_cam.c
index 6932bc8850bc..d87a69839bc8 100644
--- a/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/mac/mac_ax/security_cam.c
+++ b/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/mac/mac_ax/security_cam.c
@@ -276,6 +276,7 @@ u8 check_key_index(u8 addr_cam_sec_mode, u8 key_type, u8 key_index)
 		case SEC_CAM_KEY_TYPE_UNI:
 			if (key_index <= 6)
 				return MACSUCCESS;
+			break;
 		default:
 			break;
 		}
@@ -285,6 +286,7 @@ u8 check_key_index(u8 addr_cam_sec_mode, u8 key_type, u8 key_index)
 		case SEC_CAM_KEY_TYPE_UNI:
 			if (key_index <= 6)
 				return MACSUCCESS;
+			break;
 		default:
 			break;
 		}
@@ -1001,4 +1003,4 @@ u32 mac_wowlan_secinfo(struct mac_ax_adapter *adapter,
 	}
 
 	return MACSUCCESS;
-}
\ No newline at end of file
+}
diff --git a/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/bb/halbb_api.c b/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/bb/halbb_api.c
index df6e10dca0a0..93675d551b0f 100644
--- a/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/bb/halbb_api.c
+++ b/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/bb/halbb_api.c
@@ -852,6 +852,7 @@ u8 halbb_get_txsc(struct bb_info *bb, u8 pri_ch, u8 central_ch,
 			} else {
 				txsc_idx = 14;
 			}
+			break;
 		default:
 			break;
 	}
diff --git a/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/bb/halbb_interface.c b/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/bb/halbb_interface.c
index 47f62030d21a..d62400c4176a 100644
--- a/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/bb/halbb_interface.c
+++ b/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/bb/halbb_interface.c
@@ -582,6 +582,7 @@ u32 halbb_c2h_dm_parsing(struct bb_info *bb, u8 cmdid, u16 len, u8 *c2h)
 	#endif
 	case DM_C2H_DBG:
 		val = halbb_c2h_fw_dbg(bb, len, c2h);
+		break;
 	default:
 		break;
 	}
diff --git a/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/rf/halrf_8852b/halrf_ops_rtl8852b.h b/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/rf/halrf_8852b/halrf_ops_rtl8852b.h
index a5561bc5eb18..ee417de3aa0d 100644
--- a/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/rf/halrf_8852b/halrf_ops_rtl8852b.h
+++ b/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/rf/halrf_8852b/halrf_ops_rtl8852b.h
@@ -23,7 +23,7 @@
  *
  *****************************************************************************/
 #ifndef __HALRF_OPS_RTL8852B_H__
-#define __HALRF_OPS_RTL8852B__
+#define __HALRF_OPS_RTL8852B_H__
 #ifdef RF_8852B_SUPPORT
 
 
diff --git a/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/rf/halrf_api.c b/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/rf/halrf_api.c
index 0fda7cacabba..6aee8d6f8862 100644
--- a/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/rf/halrf_api.c
+++ b/drivers/net/wireless/realtek/rtl8852be/phl/hal_g6/phy/rf/halrf_api.c
@@ -1822,7 +1822,7 @@ bool halrf_get_dpk_by_rate(void *rf_void,
 	enum phl_phy_idx phy, enum packet_format_t vector_index, u32 rate_index)
 {
 	struct rf_info *rf = (struct rf_info *)rf_void;
-	u32 rate_addr, rate_mask, vector_value;
+	u32 rate_addr = 0, rate_mask = 0, vector_value;
 	u32 dpd_off_over, dpd_off_below, dpd_off_over_mask, dpd_off_below_mask;
 
 	RF_DBG(rf, DBG_RF_POWER, " ======>%s vector_index=%d rate_index=%d, phy=%d\n",
diff --git a/drivers/net/wireless/realtek/rtl8852be/phl/pltfm_ops_linux.h b/drivers/net/wireless/realtek/rtl8852be/phl/pltfm_ops_linux.h
index aecb19f71d96..a70bb0ea3ba7 100644
--- a/drivers/net/wireless/realtek/rtl8852be/phl/pltfm_ops_linux.h
+++ b/drivers/net/wireless/realtek/rtl8852be/phl/pltfm_ops_linux.h
@@ -397,7 +397,7 @@ static inline void *_os_pkt_buf_alloc_rx(void *d, u32 *bus_addr_l,
 #ifdef CONFIG_PCI_HCI
 	PPCI_DATA pci_data = dvobj_to_pci(pobj);
 	struct pci_dev *pdev = pci_data->ppcidev;
-	dma_addr_t dma_addr;
+	dma_addr_t dma_addr = 0;
 
 #ifdef CONFIG_RTW_RXSKB_KMALOC
 	skb = _os_alloc_fake_skb(pdev, buf_sz, cache);
diff --git a/drivers/net/wireless/realtek/rtl8852be/phl/test/verify/phl_test_verify.c b/drivers/net/wireless/realtek/rtl8852be/phl/test/verify/phl_test_verify.c
index f52af2f557bb..ddb537280d5f 100644
--- a/drivers/net/wireless/realtek/rtl8852be/phl/test/verify/phl_test_verify.c
+++ b/drivers/net/wireless/realtek/rtl8852be/phl/test/verify/phl_test_verify.c
@@ -109,6 +109,7 @@ u8 verify_bp_handler(void *ctx, struct test_bp_info *bp_info)
 			_os_sema_up(ver_ctx->phl_com->drv_priv, &(ver_ctx->cmd_sema));
 			phl_status = RTW_PHL_STATUS_SUCCESS;
 		}
+		break;
 	default:
 		break;
 	}
-- 
2.47.0

