From c24b640d039563766564deeb1285d3580b95cbf7 Mon Sep 17 00:00:00 2001
From: wanlong <long.wan@spacemit.com>
Date: Thu, 25 May 2023 14:56:16 +0800
Subject: [PATCH 0031/1448] usb: dwc3: modify DMA capability

Change-Id: Ibea2f1e19752884356d1dd8dff1d2813225ecf8d
---
 drivers/usb/dwc3/core.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.c
index 318ae24a41f4..a63566fcc489 100644
--- a/drivers/usb/dwc3/core.c
+++ b/drivers/usb/dwc3/core.c
@@ -1984,6 +1984,11 @@ static int dwc3_probe(struct platform_device *pdev)
 		ret = dma_set_mask_and_coherent(dwc->sysdev, DMA_BIT_MASK(64));
 		if (ret)
 			goto err_disable_clks;
+	} else if(!dwc->sysdev_is_parent &&
+		IS_ENABLED(CONFIG_SOC_SPACEMIT_K1PRO)) {
+		ret = dma_set_mask_and_coherent(dwc->sysdev, DMA_BIT_MASK(40));
+		if (ret)
+			goto disable_clks;
 	}
 
 	spin_lock_init(&dwc->lock);
-- 
2.47.0

