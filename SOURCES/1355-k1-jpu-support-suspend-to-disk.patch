From a17212d6d9307125d70c010bac1f6859ab6d3abd Mon Sep 17 00:00:00 2001
From: Nell <xianbin.zhu@spacemit.com>
Date: Tue, 29 Oct 2024 16:19:37 +0800
Subject: [PATCH 1355/1448] k1:jpu: support suspend to disk

Change-Id: Ie10126d7fc3a46c6cc06bdfeec3a7f9f006db15a
---
 drivers/soc/spacemit/jpu/jpu.c | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/drivers/soc/spacemit/jpu/jpu.c b/drivers/soc/spacemit/jpu/jpu.c
index 7106f79978c8..b6cb637e7681 100644
--- a/drivers/soc/spacemit/jpu/jpu.c
+++ b/drivers/soc/spacemit/jpu/jpu.c
@@ -16,6 +16,7 @@
 #include <linux/uaccess.h>
 #include <linux/cdev.h>
 #include <linux/slab.h>
+#include <linux/pm.h>
 //#include <linux/sched.h>
 #include <linux/sched/signal.h>
 #include <linux/pm_runtime.h>
@@ -1736,17 +1737,17 @@ static int jpu_remove(struct platform_device *pdev)
 }
 
 #ifdef CONFIG_PM
-static int jpu_suspend(struct platform_device *pdev, pm_message_t state)
+static int jpu_suspend(struct device *dev)
 {
 #ifndef CONFIG_SOC_SPACEMIT_K1_FPGA
-	struct jpu_device *jdev = platform_get_drvdata(pdev);
+	struct jpu_device *jdev = dev_get_drvdata(dev);
 	jpu_clk_disable(jdev);
 #endif
 
 	return 0;
 }
 
-static int jpu_resume(struct platform_device *pdev)
+static int jpu_resume(struct device *dev)
 {
 	return 0;
 }
@@ -1764,6 +1765,7 @@ static int jpu_runtime_resume(struct device *dev)
 static const struct dev_pm_ops jpu_pm_ops = {
 	.runtime_suspend = jpu_runtime_suspend,
 	.runtime_resume  = jpu_runtime_resume,
+	SET_SYSTEM_SLEEP_PM_OPS(jpu_suspend, jpu_resume)
 };
 #else
 #define jpu_suspend NULL
@@ -1782,8 +1784,6 @@ static struct platform_driver jpu_driver = {
 		    },
 	.probe = jpu_probe,
 	.remove = jpu_remove,
-	.suspend = jpu_suspend,
-	.resume = jpu_resume,
 };
 
 static int __init jpu_init(void)
-- 
2.47.0

