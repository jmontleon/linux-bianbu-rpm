From 7d2a4f99fff98fa36f9b3146aa4743ce704b0361 Mon Sep 17 00:00:00 2001
From: lizhirong <zhirong.li@spacemit.com>
Date: Wed, 27 Nov 2024 17:41:49 +0800
Subject: [PATCH 1313/1448] camera: bug: fix null pointer

Change-Id: Ifb26393cca30b1835969cb0f428b6047d6f819b5
---
 drivers/media/platform/spacemit/camera/vi/k1xvi/fe_isp.c | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/drivers/media/platform/spacemit/camera/vi/k1xvi/fe_isp.c b/drivers/media/platform/spacemit/camera/vi/k1xvi/fe_isp.c
index a1bd81c30ee5..c34f8b624278 100644
--- a/drivers/media/platform/spacemit/camera/vi/k1xvi/fe_isp.c
+++ b/drivers/media/platform/spacemit/camera/vi/k1xvi/fe_isp.c
@@ -5035,13 +5035,20 @@ static void fe_isp_dma_bh_handler(struct isp_dma_work_struct *isp_dma_work)
 	struct spm_camera_vnode *sc_vnode = dma_ctx->vnode;
 	//struct isp_context *isp_ctx = dma_ctx->isp_ctx;
 	struct spm_camera_pipeline *sc_pipeline = NULL;
-	struct media_pipeline *pipe = media_entity_pipeline(&sc_vnode->vnode.entity);
+	struct media_pipeline *pipe = NULL;
 	struct spm_camera_vbuffer *n = NULL, *pos = NULL;
 	unsigned int *hw_err_code = NULL;
 	unsigned int irq_status = isp_dma_work->irq_status;
 	LIST_HEAD(export_list);
 	unsigned long flags = 0;
 
+	if (!sc_vnode) {
+		cam_dbg("a[%d] debug 0", dma_ctx->id);
+		goto dma_tasklet_finish;
+	}
+
+	pipe = media_entity_pipeline(&sc_vnode->vnode.entity);
+
 	if (!sc_vnode || !pipe) {
 		cam_dbg("a[%d] debug 1", dma_ctx->id);
 		goto dma_tasklet_finish;
-- 
2.47.0

