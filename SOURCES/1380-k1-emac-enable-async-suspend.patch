From 7cf428e07f85c57a80cf5f0b617378f16d43bae7 Mon Sep 17 00:00:00 2001
From: Nell <xianbin.zhu@spacemit.com>
Date: Fri, 20 Dec 2024 15:07:41 +0800
Subject: [PATCH 1380/1448] k1:emac: enable async suspend

Change-Id: I7e60258dabeccec3ce78b6a2bd35bbccefcc65c6
---
 drivers/net/ethernet/spacemit/k1x-emac.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/spacemit/k1x-emac.c b/drivers/net/ethernet/spacemit/k1x-emac.c
index 417adb62582f..72d00afa47d6 100644
--- a/drivers/net/ethernet/spacemit/k1x-emac.c
+++ b/drivers/net/ethernet/spacemit/k1x-emac.c
@@ -2751,6 +2751,7 @@ static int emac_probe(struct platform_device *pdev)
 	}
 	dma_set_mask_and_coherent(&pdev->dev, DMA_BIT_MASK(32));
 
+	device_enable_async_suspend(&pdev->dev);
 	netif_napi_add(ndev, &priv->napi, emac_rx_poll);
 
 	return 0;
@@ -2857,7 +2858,7 @@ static int emac_suspend(struct device *dev)
 #endif
 
 static const struct dev_pm_ops k1x_emac_pm_qos = {
-	SET_SYSTEM_SLEEP_PM_OPS(emac_suspend, emac_resume)
+	NOIRQ_SYSTEM_SLEEP_PM_OPS(emac_suspend, emac_resume)
 };
 
 static const struct of_device_id emac_of_match[] = {
-- 
2.47.0

