From cd006440d2c85c2711202db662f2d4f9489c284e Mon Sep 17 00:00:00 2001
From: liweizhi <weizhi.li@spacemit.com>
Date: Thu, 9 Jan 2025 21:11:32 +0800
Subject: [PATCH 1441/1448] kbuild: deb-pkg: add provide field for version
 control

Change-Id: Ic7032de19ee32c7c53425f2afcc9faba7e35274c
---
 scripts/package/mkdebian | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/scripts/package/mkdebian b/scripts/package/mkdebian
index 414ebaede4ba..7480249ce3fe 100755
--- a/scripts/package/mkdebian
+++ b/scripts/package/mkdebian
@@ -147,6 +147,7 @@ fi
 
 # Some variables and settings used throughout the script
 version=$KERNELRELEASE
+baseversion=$(echo $version | cut -d- -f1)
 if [ -n "$KDEB_PKGVERSION" ]; then
 	packageversion=$KDEB_PKGVERSION
 else
@@ -227,6 +228,7 @@ Description: Linux kernel, version $version
  This package contains the Linux kernel, modules and corresponding other
  files, version: $version.
 Depends: spacemit-flash-dtbs
+Provides: linux-image-$baseversion
 EOF
 
 if [ "${SRCARCH}" != um ]; then
@@ -245,11 +247,12 @@ Package: linux-tools-$version
 Architecture: $debarch
 Section: devel
 Depends: linux-tools-common
-Description: Linux kernel version specific tools for version -$version
+Description: Linux kernel version specific tools for version $version
  This package provides the architecture dependant parts for kernel
  version locked tools (such as perf) for
- version -$version on
+ version $version on
  .
+Provides: linux-tools-$baseversion
 
 Package: linux-tools-common
 Architecture: all
@@ -271,6 +274,7 @@ Description: Linux kernel headers for $version on $debarch
  This package provides kernel header files for $version on $debarch
  .
  This is useful for people who need to build external modules
+Provides: linux-headers-$baseversion
 EOF
 fi
 fi
@@ -284,6 +288,7 @@ Architecture: $debarch
 Description: Linux kernel debugging symbols for $version
  This package will come in handy if you need to debug the kernel. It provides
  all the necessary debug symbols for the kernel and its modules.
+Provides: linux-image-$baseversion-dbg
 EOF
 fi
 
-- 
2.47.0

