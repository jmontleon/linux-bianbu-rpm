From b39d1852ef4bf7fe06b47ddb4ea7cfda8a201ef1 Mon Sep 17 00:00:00 2001
From: weijinmei <jinmei.wei@space-t.cn>
Date: Fri, 21 Jun 2024 11:40:58 +0800
Subject: [PATCH 0800/1448] es8326: fix es8326 compile error

Change-Id: I32419a315105a18ad107c6cd3e624e5a5448d150
---
 sound/soc/codecs/es8326.c | 16 ++++++----------
 sound/soc/codecs/es8326.h |  4 ++++
 2 files changed, 10 insertions(+), 10 deletions(-)

diff --git a/sound/soc/codecs/es8326.c b/sound/soc/codecs/es8326.c
index 5e469ab3002f..ddc96159f3e9 100644
--- a/sound/soc/codecs/es8326.c
+++ b/sound/soc/codecs/es8326.c
@@ -1345,9 +1345,6 @@ static const struct snd_soc_component_driver soc_component_dev_es8326 = {
 static int es8326_i2c_probe(struct i2c_client *i2c)
 {
 	struct es8326_priv *es8326;
-#ifdef SPACEMIT_CONFIG_CODEC_ES8326
-	enum of_gpio_flags flags;
-#endif
 	int ret;
 
 	es8326 = devm_kzalloc(&i2c->dev, sizeof(struct es8326_priv), GFP_KERNEL);
@@ -1384,10 +1381,9 @@ static int es8326_i2c_probe(struct i2c_client *i2c)
 	}
 
 #ifdef SPACEMIT_CONFIG_CODEC_ES8326
-	es8326->spk_ctl_gpio = of_get_named_gpio_flags(i2c->dev.of_node,
+	es8326->spk_ctl_gpio = of_get_named_gpio(i2c->dev.of_node,
 						       "spk-ctl-gpio",
-						       0,
-						       &flags);
+						       0);
 	if (es8326->spk_ctl_gpio < 0) {
 		dev_info(&i2c->dev, "Can not read property spk_ctl_gpio\n");
 		es8326->spk_ctl_gpio = -1;
@@ -1400,8 +1396,8 @@ static int es8326_i2c_probe(struct i2c_client *i2c)
 		}
 		es8326_enable_spk(es8326, false);
 	}
-	es8326->hp_gpio = of_get_named_gpio_flags(i2c->dev.of_node,
-					"hp-detect-gpio", 0, &flags);
+	es8326->hp_gpio = of_get_named_gpio(i2c->dev.of_node,
+					"hp-detect-gpio", 0);
 	if (es8326->hp_gpio < 0) {
 		dev_info(&i2c->dev, "Can not read property hp-detect-gpio\n");
 		es8326->hp_gpio = -1;
@@ -1415,8 +1411,8 @@ static int es8326_i2c_probe(struct i2c_client *i2c)
 			return ret;
 		}
 	}
-	es8326->mic_gpio = of_get_named_gpio_flags(i2c->dev.of_node,
-					"mic-detect-gpio", 0, &flags);
+	es8326->mic_gpio = of_get_named_gpio(i2c->dev.of_node,
+					"mic-detect-gpio", 0);
 	if (es8326->mic_gpio < 0) {
 		dev_info(&i2c->dev, "Can not read property mic-detect-gpio\n");
 		es8326->mic_gpio = -1;
diff --git a/sound/soc/codecs/es8326.h b/sound/soc/codecs/es8326.h
index 4234bbb900c4..c9ad5ef936f6 100644
--- a/sound/soc/codecs/es8326.h
+++ b/sound/soc/codecs/es8326.h
@@ -194,4 +194,8 @@
 #define ES8326_VERSION (1 << 0)
 #define ES8326_VERSION_B (3 << 0)
 
+#if IS_ENABLED(CONFIG_SND_SOC_SPACEMIT)
+#define SPACEMIT_CONFIG_CODEC_ES8326 1
+#endif
+
 #endif
-- 
2.47.0

